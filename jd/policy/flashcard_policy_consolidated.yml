# Consolidated Flashcard Policy v3
# Combines schema definitions and validation rules

# Schema definition
schema:
  required_fields:
    - front
    - back
    - why_it_matters
    - mnemonic
    - diagram
    - tripwires
    - anchors
    - keywords
    - reading_level
    - tags

# Global rules and settings
global_rules:
  language: Australian English
  citation: AGLC4
  enforce_pinpoints: true
  prefer_quotes: double
  zero_invented_authorities: true
  front_must_end_with_question_mark: true
  front_max_words: 30
  back_min_length: 20

# Rule configurations for validation
validation_rules:
  # Front matter validations
  F001:
    enabled: true
    severity: error
    description: Required fields must be present
    
  F002:
    enabled: true
    severity: error
    description: Front should end with a question mark
    
  F003:
    enabled: true
    severity: warning
    description: Front should be concise
    max_words: 30
    
  # Back matter validations
  B001:
    enabled: true
    severity: warning
    description: Back should contain sufficient content
    min_length: 20
    
  B002:
    enabled: true
    severity: warning
    description: Legal references should be properly cited
    
  # Diagram validations
  D001:
    enabled: true
    severity: error
    description: Mermaid diagrams must be valid

# Auto-fix configurations
autofix:
  F002: true  # Add missing question marks
  F003: true  # Truncate long fronts
  B001: true  # Add placeholder content
  D001: true  # Fix diagram syntax

# Field-specific configurations
front:
  max_words: 30
  must_end_with_question_mark: true
  discourage_multi_question_fronts: true

back:
  min_words: 180
  max_words: 260
  max_sentence_words: 32
  required_headings_regex:
    - "^Issue\\."
    - "^Rule\\."
    - "^Application scaffold\\."
    - "^Authorities map\\."
    - "^Statutory hook\\."
    - "^Tripwires\\."
    - "^Conclusion\\."
  allow_missing_blocks_if_not_applicable: true
  issue_guidance: "Add context/threshold not already in the front; no verbatim repetition."
  authority_per_step:
    lead_required: true
    fallback_allowed: true
    max_per_step: 2
  statutes_listed_must_be_used_in_text: true

# Other configurations (anchors, authorities, etc.) remain the same as in cards_policy.yml
anchors:
  structure: {cases: [], statutes: [], notes: []}
  min_items: 1
  max_items: 8
  each_item_max_words: 120
  require_case_or_statute_ref_per_item: true
  uk_or_persuasive_requires_note: true

statutes:
  include_only_operational_sections: true
  prefer_victoria_first: true
  require_commonwealth_if_engaged: true

authorities:
  priority_order: ["HCA", "State CA", "Other Aus", "UK/PC (nuance)"]
  uk_nuance_note_required: true
  flag_overruled_or_distinguished: true
  require_year_and_neutral_or_report_cite: true
  min_unique_authorities_in_back: 2
  max_unique_authorities_in_back: 8

diagram:
  type: mindmap
  must_be_valid_mermaid: true
  max_total_nodes: 12
  top_level_branches_min: 4
  top_level_branches_max: 5
  discourage_heading_mirroring: true

tripwires:
  min: 3
  max: 6
  examples_to_encourage:
    - conflating duty existence vs scope
    - citing multiple authorities for the same bare proposition
    - importing policy that cuts against coherence (Sullivan v Moody)
    - misusing Wrongs Act calculus (s 48) vs general negligence
    - skipping statutory thresholds (Pt VBA)

# Metadata
_meta:
  version: 3.0
  created: 2025-09-25
  description: Consolidated flashcard policy combining schema and validation rules
